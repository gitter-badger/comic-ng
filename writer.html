<!DOCTYPE html>
<html>
    <head>
        <!--<script title="DEBUG" src="http://code.jquery.com/jquery-1.11.3.js"></script>-->
        <script src="js/vers.js"></script>
        <link rel="stylesheet" type="text/css" href="js/bootstrap.min.css"/>
        <script src="js/jquery-2.1.4.min.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <!--<link rel="stylesheet" type="text/css" href="https://bootswatch.com/simplex/bootstrap.min.css"/>
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>-->
    </head>
    <body style="margin:4px; padding:4px">
        <h1 >Writer</h1>
        <span id=MHEAD></span>
        <div id="accordion">
            <h3 class="button" role="button">* Settings</h3>
            <div>
                <form action="#" onsubmit="">
                    <h4>Configuration</h4>
                    <label for="dir">Directory</label>
                    <input value="assets/" id="dir" type="text" title="Image directory"><br>
                    <label for="psn_0">Page Start</label>
                    <input type="radio" id="psn_0" name="psb" checked>0<input type="radio" id="psn_1" name="psb" >1<br>
                    <label for="csn_0">Chapter Start</label>
                    <input type="radio" id="csn_0" name="csb" checked>0<input type="radio" id="csn_1" name="csb" >1<br>
                    <label for="prb">Pre-Buffer</label>
                    <input type="number" value=5 id="prb" min="1" max="100" title="How far behind images are preloaded"><br>
                    <label for="ptb">Post-Buffer</label>
                    <input type="number" value=5 id="ptb" min="1" max="100" title="How far ahead images are preloaded"><br>
                    <h4 id="CHPHEAD">Chapters</h4>
                    <button id="add2">+</button>
                    <ol id="Csort"></ol>
                    <h4 id="PGEHEAD">Pages</h4>
                    <input id="conductor" type="file" multiple>
                    <ol id="sorted"></ol>
                    <input id="ExBtn" type="submit" value="Export">
                </form>
            </div>
            <h3 class="button" role="button">* Design</h3>
            <div><span class="error" style="color:red">This Feature is not yet implemented.</span></div>
        <script>
            var jQ = jQuery.noConflict();
            console.log("%c %c %c comic-ng Writer v"+ vers_wr.version() +" %c \u262F %c \u00A9 2015 Oluwaseun Ogedengbe %c ", "color:white; background:#B5B5B5", "background:purple","color:black; background:#E2E2E2", 'color:red; background:black', "color:black; background:#B5B5B5", "background:purple");
            jQ("#CHPHEAD").data({});
            jQ("#accordion").accordion({collapsible: true,
      heightStyle: "content"});
                /*.sortable({
                    axis: "y",
                    handle: "h3",
                    stop: function( event, ui ) {
                      // IE doesn't register the blur when sorting
                      // so trigger focusout handlers to remove .ui-state-focus
                      ui.item.children( "h3" ).triggerHandler( "focusout" );

                      // Refresh accordion to handle new order
                      $( this ).accordion( "refresh" );
                    }
                  });*/
            jQ("#add2").click(function(){
                var oper = jQ("#Csort").childElementCount;
                jQ("#Csort").append("<li id=c"+oper+">"+"Chapter"+" <button onClick=settingsC('#c"+oper+"')>&#x2731</button><button onClick=jQ('#c"+oper+"').remove()>X</button> </li>").sortable({ scroll: true});
                jQ("#c"+oper).data({
                    open: false,
                    body: {
                    description: "", 
                    end: 0, 
                    start: 0, 
                    title: "",}
                }).addClass("chap");
            });
            jQ("#conductor").change(function() {
                console.log(this.files);
                jQ("#sorted").innerHTML ="";
                for (i = 0; i < this.files.length; i++){
                    jQ("#sorted").append("<li id=s"+i+">"+this.files[i].name+" <button onClick=settingsP('#s"+i+"');>&#x2731</button><button onClick=jQ('#s"+i+"').remove()>X</button></li>").sortable({ scroll: true});
                jQ("#s"+i).data({
                    open: false,
                    body: {
                        alt: "", 
                        hover: "", 
                        title: "",
                        url: this.files[i].name, 
                        release: 0,
                        note: "",}
                }).addClass("page");
            }});
            jQ("#ExBtn").click(function(){
                var setOBJ = {
                    config: {},
                    chapters: [],
                    pages: []
                };
                /*delete window.alert;
                alert("Settings Configured!");*/
                setOBJ.config.dir = jQ("#dir").val();
                setOBJ.config.pagestartnum = document.getElementById("psn_1").checked;
                setOBJ.config.chapterstartnum = document.getElementById("csn_1").checked;
                setOBJ.config.imgprebuffer = jQ("#prb").val();
                setOBJ.config.imgpostbuffer = jQ("#ptb").val();
                
                for (j = 0; j < document.getElementById("Csort").childElementCount; j++){
                    setOBJ.chapters.push(jQ(".class,li").eq(j).data().body);
                }
                for (j = 0; j < document.getElementById("sorted").childElementCount; j++){
                    setOBJ.pages.push(jQ(".page,li").eq(j).data().body);
                }
                console.log(setOBJ);
                jQ('#setlink').remove();
                var refh = "<a onClick=jQ('#setlink').remove() id='setlink' href='data: text/json;charset=utf-8," + JSON.stringify(setOBJ,["config","pages","chapters","dir","pagestartnum","chapterstartnum","imgprebuffer","imgpostbuffer","alt","hover","title","url","release","note","description","start","end","title"]) + "' download='config.json' autofocus>config.json</a>";
                console.log(refh);
                jQ(refh).appendTo("#MHEAD");
            });
            var settingsP = function(ele){
                var lee = ele.substring(1);
                console.log(ele);
                console.log(jQ(ele).data().open);
                if (jQ(ele).data().open){
                    /*console.log("deleting");*/
                    jQ(ele).data().body.title = jQ("#TEMP_title"+lee).val();
                    jQ(ele).data().body.hover = jQ("#TEMP_hover"+lee).val();
                    jQ(ele).data().body.note = jQ("#TEMP_note"+lee).val();
                    jQ(ele).data().body.alt = jQ("#TEMP_alt"+lee).val();
                    jQ(ele).data().body.release = jQ("#TEMP_release"+lee).val();
                    jQ(ele).data().body.url = jQ("#TEMP_url"+lee).val();
                    jQ("#TEMPFORM_"+lee).remove();
                    /*document.getElementById(ele.substring(1)).removeChild(document.getElementById("TEMPFORM_"+ele));fallback*/
                    jQ(ele).focus();
                    jQ(ele).data().open = false;
                    console.log(jQ(ele).data());
                }else {
                    jQ(ele).append("<form id='TEMPFORM_"+lee+"' autofocus><label for='TEMP_title"+lee+"'>Title&nbsp</label><input value='"+jQ(ele).data().body.title+"' id='TEMP_title"+lee+"' type='text' autofocus><br><label for='TEMP_hover"+lee+"'>Hover&nbsp</label><input value='"+jQ(ele).data().body.hover+"' id='TEMP_hover"+lee+"' type='text' title='Text on Mouse Over'><br><label for='TEMP_note"+lee+"'>Image Info&nbsp</label><input value='"+jQ(ele).data().body.note+"' id='TEMP_note"+lee+"' type='text'><br><label for='TEMP_alt"+lee+"'>Alt Text&nbsp</label><input value='"+jQ(ele).data().body.alt+"' id='TEMP_alt"+lee+"' type='text' title='If the image fails to load this text is loaded instead'><br><label for='TEMP_release"+lee+"'>Release Date&nbsp </label><input value='"+jQ(ele).data().body.release+"' id='TEMP_release"+lee+"' type='number' title='When should this slide be avaliable'><br><label for='TEMP_url"+lee+"'>URL&nbsp</label><input value='"+jQ(ele).data().body.url+"' id='TEMP_url"+lee+"' type='text' title='Filename of the image'><br></form>");
                    jQ(ele).focus();
                    jQ(ele).data().open = true;
                }
                return true;
            };
            var settingsC = function(ele){
                var lee = ele.substring(1);
                console.log(ele);
                console.log(jQ(ele).data().open);
                if (jQ(ele).data().open){
                    jQ(ele).data().body.description = jQ("#TEMP_description"+lee).val();
                    jQ(ele).data().body.end = jQ("#TEMP_end"+lee).val();
                    jQ(ele).data().body.start = jQ("#TEMP_start"+lee).val();
                    jQ(ele).data().body.title = jQ("#TEMP_title"+lee).val();
                    jQ("#TEMPFORM_"+lee).remove();
                    
                    jQ(ele).focus();
                    jQ(ele).data().open = false;
                    console.log(jQ(ele).data());
                }else {
                    jQ(ele).append("<form id='TEMPFORM_"+lee+"' autofocus><label for='TEMP_title"+lee+"'>Title&nbsp</label><input value='"+jQ(ele).data().body.title+"' id='TEMP_title"+lee+"' type='text' autofocus><br><label for='TEMP_description"+lee+"'>Description&nbsp</label><input value='"+jQ(ele).data().body.description+"' id='TEMP_description"+lee+"' type='text' title='Chapter description'><br><label for='TEMP_start"+lee+"'>Start&nbsp</label><input value='"+jQ(ele).data().body.start+"' id='TEMP_start"+lee+"' type='text' title='Starting page ID value'><br><label for='TEMP_end"+lee+"'>End&nbsp</label><input value='"+jQ(ele).data().body.end+"' id='TEMP_end"+lee+"' type='text' title='Ending page ID value'><br></form>");
                    jQ(ele).focus();
                    jQ(ele).data().open = true;
                }
                return true;
            };
        </script>
    </body>
</html>